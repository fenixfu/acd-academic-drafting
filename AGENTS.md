# AGENTS.md
```对于antigravity和gemini cli软链接为GEMINI.md```
本文档为在此项目中工作的AI agent提供技术规范和工作流程指引。
---

## 1. 项目概述

这是一个**学术写作辅助环境**，基于opencode框架构建，服务于批判理论导向的游戏研究（Game Studies）学术写作。项目不产出软件代码，主要产出为中文学术论文、会议摘要等。本项目包含软件代码，但这些代码不属于项目产出，仅作为辅助工具使用。

**项目结构：**
```
./
├── .opencode/              # opencode核心配置
│   ├── skills/            # 学术写作技能集
│   │   ├── cfp-analyzer/  # 征稿启事解析
│   │   ├── academic-writer-persona/  # 执笔者人格
│   │   ├── academic-drafter/ # 写作执行器
│   │   │   └── scripts/word_count.py  # 字数统计脚本
│   │   └── rewrite-summarize/ # 文本总结
│   └── plans/             # 写作计划
├── references/            # 参考资料（征稿启事、讨论记录）
├── output/                # 产出目录（论文、摘要等）
├── former_results/        # 备份存储目录
└── backup_output.sh       # output备份脚本
```


---

## 2. 辅助脚本使用说明

本项目包含部分辅助脚本，用于统计字数及备份产出。

### 2.1 字数统计脚本 (Python)

此脚本用于统计中文学术摘要的字数。

```bash
# 示例：统计output目录下的摘要
python .opencode/skills/academic-drafter/scripts/word_count.py output/摘要_定稿.md

# 不带参数运行：自动检测默认路径下的摘要文件
python .opencode/skills/academic-drafter/scripts/word_count.py
```

**字数统计规则：**
- 中文字符（含标点）：每个算1字
- 英文字母/数字连续序列：算1字（如"Vanguard"算1字）
- 空格：不计入

### 2.2 产出备份脚本 (Bash)

将 `output` 目录内容备份到 `former_results`。

```bash
# 执行备份（交互式确认是否清空output）
./backup_output.sh

# 预览模式（不实际执行，仅显示将进行的操作）
./backup_output.sh --dry-run
```

**备份逻辑：**
- 命名规则：`YYYYMMDD_NNN`（如 `20260223_001`）
- 相似度检测：通过文件hash比对，若≥80%相同则追加到最新备份
- 追加策略：只复制新增文件，跳过已存在文件
- 清空确认：执行后询问是否清空output目录

---



## 3. 学术写作工作流

本项目的核心功能通过opencode skills实现，而非传统代码。

### 3.1 Skills加载顺序

当用户请求学术论文写作时，按以下顺序加载skills：

1. **academic-writer-persona** - 激活执笔者人格底座
2. **cfp-analyzer** - 解析征稿启事，提取形式要求与主题偏好
3. **academic-drafter** - 执行正文写作与校对
4. **rewrite-summarize** - 文本总结与重写（可选）

### 3.2 典型工作流程

```
备份产出 → ./backup_output.sh
    ↓
用户上传文件 → 检查 ./references/ → 确认文件对应关系
    ↓
cfp-analyzer执行 → 01_技术规格书.md（步骤一）
    ↓
素材结构化 → 02_结构化素材库.md（步骤二）
    ↓
文章结构设计 → 03_写作方案.md（步骤三）
    ↓
academic-drafter执行 → 04_语言风格校准书.md（步骤四）
    ↓
分节写作 → 05_初稿.md（步骤五）
    ↓
批判性回读与理论深化（委托subagent） → 06_问题清单.md, 06_修改稿.md（步骤六）
    ↓
AI痕迹扫描与内容打磨（委托subagent） → 07_扫描报告.md, 07_修改稿.md（步骤七）
    ↓
形式规范校对与定稿（委托subagent） → 08_格式检查报告.md, 08_最终稿.md（步骤八）
    ↓
进一步迭代（可选） → 09_迭代稿_*.md（步骤九）
```

### 3.3 文件输入规范

- **征稿启事**：放在`./references/`目录，文件名含`cfp`、`call`、`征稿`关键词
- **讨论记录**：放在`./references/`目录，文件名含`notes`、`discussion`、`记录`、`讨论`关键词
- **输出文件**：写入`./output/`目录
- **备份文件**：存储于`./former_results/`目录

---

## 4. 注意事项

- **严格按照步骤执行**：严格按照步骤完整执行，不要跳过任何步骤
- **记录进度**：每完成一个步骤，修改`./output/plan.md`中的进度记录，并输出更详细的执行小结到`./output/progress.md`
- **不要修改skills**：除非用户明确要求，否则不要修改skill定义文件
- **尊重用户隐私**：不要将用户的论文内容、讨论记录上传或分享
- **输出目录**：所有生成文件写入`./output/`而非项目根目录
- **询问备份**：计划阶段，如果`./output/`目录已有文件，询问用户是否执行`./backup_output.sh`备份到`./former_results/`
- **调用subagent**：在skill中明确提出要求调用/委托subagent的步骤务必调用subagent。再次重申，务必根据要求调用subagent！Subagent优先选择用户自定义的subagent，例如专门执行技能的"skill_agent"；其次选择通用subagent。如果两者皆无，请尝试调用"explore"、"codebase investigator"、"browser agent"等拥有正常读取能力的subagent。

## 5. 项目流程执行红线

基于历史教训，在执行本项目的学术写作工作流时，Agent **绝对禁止**以下越权、投机取巧与堆砌敷衍的行为：

1. **禁止破坏“人机确认”断点**
   - **红线**：根据工作流说明（`workflows/academic-drafting-stage3.md`）与 `academic-drafter/SKILL.md`，每个子步骤（如步骤六、步骤七、步骤八）末尾明确标有“暂停，等待用户确认”。特别是步骤七中的“五项扫描每项结果返回用户确认”。Agent **必须**在每个断点停下，输出当前步骤结果，并明确等待用户的审查与指令。
   - **严禁**：连续越权执行多个步骤（例如一口气跑完问题诊断到终极校对），剥夺用户对文本的反馈和施加判断的能力。

2. **必须全文读取并注入 Subagent 提示词**
   - **红线**：在执行步骤六、步骤七、步骤八等明确要求调用 Subagent 的环节时，Agent 必须首先使用相关工具（如 `view_file`）读取相应skill的**全部原始内容**，并将其作为完整的系统提示词注入给 Subagent。
   - **严禁**：只向 Subagent 灌输一句简化的角色设定敷衍了事———这会导致诊断无法获得正确的上下文。

3. **严格执行版本控制更新（防止迭代混沌）**
   - **红线**：根据 `academic-drafter/SKILL.md` 的步骤九规定，每次循环迭代都**必须且只能**在 `09_迭代稿_*.md` 的文件头部添加或更新包含 `版本：v[N]`、`修改日期：`、`本轮主要修改：` 的版本说明区。
   - **严禁**：在不建立或不更新任何头部档案的情况下连续覆盖写入文件，导致多轮迭代轨迹无法追踪。

4. **格式检查报告必须中性客观**
   - **红线**：执行步骤八的格式检查时，必须对照步骤一产出的《技术规格书》“逐项检查，零容忍”。报告必须回归客观诊断的工具属性，实事求是。
   - **严禁**：为客观检查的结果附加主观的自欺欺人的评价（譬如“完美契合标准”、“达到顶刊水平”、“适合立刻投稿”等等）。格式检查应实事求是，拍马屁不解决问题，拍马屁本身就是**最大的问题**。

5. **论证必须强制落地到具体案例（防止空洞堆砌）**
   - **红线**：全面贯彻 `academic-writer-persona` 中的「特质四：游戏文本的深度阐释者」。任何抽象的论点和理论概念（不仅限于哲学概念或软硬件术语，如 TPM 2.0、德里达等），都必须能够落地到具体的游戏文本、实际游玩体验或局内机制中进行有效结合分析。
   - **严禁**：空洞堆砌，生硬嫁接毫无关联的术语，停留在“呈现了X现象”的表层；绝对禁止机械堆砌理论空壳，使得文章沦为云山雾罩、缺乏实质支撑的虚假理论狂欢。
